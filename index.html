<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algo For You - Complete Algorithmic Trading Platform</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Brightex Tech Color Scheme */
        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #06b6d4;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --gradient: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            --gradient-2: linear-gradient(135deg, #1e40af, #06b6d4);
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            overflow-x: hidden;
            font-size: 14px;
            background: #000000;
        }

        /* Header & Navigation - UPDATED WITH ALL MENUS */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 1000;
            padding: 12px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Enhanced Logo */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-img {
            width: 42px;
            height: 42px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .company-name {
            font-size: 1.7rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e40af, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            letter-spacing: -0.5px;
        }

        .company-tagline {
            font-size: 0.65rem;
            color: var(--text-light);
            font-weight: 600;
            letter-spacing: 0.8px;
            margin-top: 2px;
        }

        /* UPDATED NAV MENU WITH ALL SECTIONS */
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .nav-menu a:hover {
            color: var(--primary);
            background: rgba(30, 64, 175, 0.1);
        }

        /* User Profile in Header */
        .user-profile {
            display: none;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .dropdown-menu {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            z-index: 1001;
        }

        .dropdown-menu a {
            display: block;
            padding: 12px 20px;
            color: var(--text-dark);
            text-decoration: none;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-menu a:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .user-profile:hover .dropdown-menu {
            display: block;
        }

        /* Login Button */
        .login-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        /* Market Ticker */
        .market-ticker {
            background: rgba(30, 64, 175, 0.95);
            color: white;
            padding: 12px 0;
            position: fixed;
            top: 70px;
            width: 100%;
            z-index: 999;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ticker-content {
            display: flex;
            align-items: center;
            justify-content: space-around;
            font-size: 0.9rem;
            font-weight: 600;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Hero Section */
        .hero {
            background: var(--gradient);
            color: var(--white);
            padding: 180px 0 100px;
            position: relative;
            overflow: hidden;
            text-align: center;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: var(--white);
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* Main Content Sections */
        .content-section {
            padding: 100px 0;
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        #home {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .section-header p {
            color: var(--text-light);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Back to Home Button */
        .back-to-home {
            position: fixed;
            top: 120px;
            left: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .back-to-home:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* ========== BACKTESTING STYLES ========== */
        .backtest-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .parameters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .param-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .param-group label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .run-backtest {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 30px auto;
        }

        .run-backtest:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .metric-label {
            color: var(--text-light);
            margin-top: 5px;
        }

        /* ========== PORTFOLIO STYLES ========== */
        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-top: 10px;
        }

        .add-holding-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        /* ========== TRADE JOURNAL STYLES ========== */
        .trade-entry-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .trade-statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-light);
            margin-top: 5px;
        }

        /* ========== STRATEGY BUILDER STYLES ========== */
        .strategy-builder-container {
            display: flex;
            gap: 30px;
            min-height: 600px;
        }

        .toolbox {
            width: 250px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .indicator, .condition, .action {
            padding: 12px;
            margin: 10px 0;
            background: var(--bg-light);
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .indicator:hover, .condition:hover, .action:hover {
            background: var(--primary);
            color: white;
            transform: translateX(5px);
        }

        .workspace {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            min-height: 500px;
        }

        .workspace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .strategy-flow {
            min-height: 400px;
            border: 2px dashed #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* ========== ALERTS STYLES ========== */
        .alerts-container {
            display: grid;
            gap: 30px;
        }

        .create-alert-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .alert-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .active-alerts {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .alerts-list {
            margin-top: 20px;
        }

        .alert-item {
            padding: 15px;
            border-left: 4px solid var(--primary);
            background: var(--bg-light);
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ========== MODAL STYLES ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 30px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        /* ========== TABLE STYLES ========== */
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .trades-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .trades-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .trades-table tr:hover {
            background: var(--bg-light);
        }

        /* ========== CHART STYLES ========== */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        /* ========== RESPONSIVE STYLES ========== */
        @media (max-width: 1024px) {
            .nav-menu {
                gap: 15px;
            }
            
            .hero h1 {
                font-size: 2.8rem;
            }
            
            .strategy-builder-container {
                flex-direction: column;
            }
            
            .toolbox {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--white);
                flex-direction: column;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .market-ticker {
                top: 70px;
            }
            
            .ticker-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-grid, .form-row, .alert-form {
                grid-template-columns: 1fr;
            }
            
            .parameters-grid {
                grid-template-columns: 1fr;
            }
            
            .performance-metrics, .portfolio-summary, .trade-statistics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .back-to-home {
                top: 100px;
                left: 10px;
                padding: 10px 15px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .performance-metrics, .portfolio-summary, .trade-statistics {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .section-header h2 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Back to Home Button -->
    <button class="back-to-home" id="backToHome">
        <i class="fas fa-arrow-left"></i>
        Back to Home
    </button>

    <!-- Market Ticker -->
    <div class="market-ticker">
        <div class="ticker-content">
            <div class="ticker-item up" id="niftyTicker">
                <i class="fas fa-chart-line"></i>
                <div>
                    <div class="ticker-price">NIFTY 50: <span id="niftyPrice">22,403.85</span></div>
                    <div class="ticker-change" id="niftyChange">+62.20 (+0.28%)</div>
                </div>
            </div>
            <div class="ticker-item up" id="bankniftyTicker">
                <i class="fas fa-chart-line"></i>
                <div>
                    <div class="ticker-price">BANK NIFTY: <span id="bankniftyPrice">48,026.90</span></div>
                    <div class="ticker-change" id="bankniftyChange">+128.45 (+0.27%)</div>
                </div>
            </div>
            <div class="ticker-item up" id="sensexTicker">
                <i class="fas fa-chart-line"></i>
                <div>
                    <div class="ticker-price">SENSEX: <span id="sensexPrice">73,895.54</span></div>
                    <div class="ticker-change" id="sensexChange">+149.98 (+0.20%)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header with Complete Navigation -->
    <header class="header">
        <div class="nav-container">
            <a href="#home" class="logo-container">
                <div class="logo-img">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">
                    <div class="company-name">ALGO FOR YOU</div>
                    <div class="company-tagline">ALGORITHMIC TRADING</div>
                </div>
            </a>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="#home">Home</a></li>
                <li><a href="#market">Live Market</a></li>
                <li><a href="#backtesting">Backtesting</a></li>
                <li><a href="#portfolio">Portfolio</a></li>
                <li><a href="#trade-journal">Trade Journal</a></li>
                <li><a href="#strategy-builder">Strategy Builder</a></li>
                <li><a href="#alerts">Alerts</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#packages">Packages</a></li>
                <li><a href="#testimonials">Testimonials</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="dropdown-menu">
                    <a href="#" onclick="showDashboard()"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    <a href="#portfolio"><i class="fas fa-chart-pie"></i> Portfolio</a>
                    <a href="#trade-journal"><i class="fas fa-book"></i> Trade Journal</a>
                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
            
            <button class="login-btn" id="loginBtn" onclick="showLoginModal()">
                <i class="fas fa-user"></i> Login
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-container">
            <h1>Complete Algorithmic Trading Platform</h1>
            <p>Everything You Need for Successful Trading: Backtesting, Portfolio Tracking, Alerts & More!</p>
            
            <div class="quick-actions">
                <button class="action-btn" onclick="showSection('backtesting')">
                    <i class="fas fa-chart-line"></i>
                    Start Backtesting
                </button>
                <button class="action-btn" onclick="showSection('portfolio')">
                    <i class="fas fa-chart-pie"></i>
                    Track Portfolio
                </button>
                <button class="action-btn" onclick="openCalculator()">
                    <i class="fas fa-calculator"></i>
                    Calculators
                </button>
                <button class="action-btn" onclick="showSection('strategy-builder')">
                    <i class="fas fa-puzzle-piece"></i>
                    Build Strategy
                </button>
                <button class="action-btn" onclick="showLoginModal()">
                    <i class="fas fa-user"></i>
                    Login/Register
                </button>
            </div>
        </div>
    </section>

    <!-- =================== ALL FEATURES SECTIONS =================== -->

    <!-- Live Market Section -->
    <section id="market" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Live Market Data</h2>
                <p>Real-time charts and market data</p>
            </div>
            <div class="chart-container">
                <div id="market-charts"></div>
            </div>
        </div>
    </section>

    <!-- Backtesting Section -->
    <section id="backtesting" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Strategy Backtesting</h2>
                <p>Test your trading strategies with historical data</p>
            </div>
            
            <div class="backtest-container">
                <!-- Backtesting content will be added dynamically -->
                <div id="backtestContent">
                    <div class="parameters-grid">
                        <div class="param-group">
                            <label>Select Strategy</label>
                            <select class="form-control" id="strategySelect">
                                <option value="ma_crossover">Moving Average Crossover</option>
                                <option value="rsi">RSI Strategy</option>
                                <option value="bollinger">Bollinger Bands</option>
                                <option value="macd">MACD Strategy</option>
                            </select>
                        </div>
                        
                        <div class="param-group">
                            <label>Stock/Index</label>
                            <select class="form-control" id="backtestSymbol">
                                <option value="NIFTY">NIFTY 50</option>
                                <option value="BANKNIFTY">BANK NIFTY</option>
                                <option value="RELIANCE">RELIANCE</option>
                                <option value="TCS">TCS</option>
                            </select>
                        </div>
                        
                        <div class="param-group">
                            <label>Time Period</label>
                            <select class="form-control" id="backtestPeriod">
                                <option value="1m">1 Month</option>
                                <option value="3m">3 Months</option>
                                <option value="6m">6 Months</option>
                                <option value="1y">1 Year</option>
                            </select>
                        </div>
                        
                        <div class="param-group">
                            <label>Initial Capital (₹)</label>
                            <input type="number" class="form-control" id="initialCapital" value="100000">
                        </div>
                    </div>
                    
                    <button class="run-backtest" onclick="runBacktest()">
                        <i class="fas fa-play"></i> Run Backtest
                    </button>
                    
                    <div id="backtestResults" style="display: none;">
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="totalReturn">0%</div>
                                <div class="metric-label">Total Return</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="totalProfit">₹0</div>
                                <div class="metric-label">Total Profit</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="winRate">0%</div>
                                <div class="metric-label">Win Rate</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="maxDrawdown">0%</div>
                                <div class="metric-label">Max Drawdown</div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="equityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Tracker -->
    <section id="portfolio" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Portfolio Tracker</h2>
                <p>Track all your investments in one place</p>
            </div>
            
            <div class="portfolio-summary">
                <div class="summary-card">
                    <h4>Total Investment</h4>
                    <div class="summary-value" id="totalInvestment">₹0</div>
                </div>
                <div class="summary-card">
                    <h4>Current Value</h4>
                    <div class="summary-value" id="currentValue">₹0</div>
                </div>
                <div class="summary-card">
                    <h4>Total P&L</h4>
                    <div class="summary-value" id="totalPnl">₹0</div>
                </div>
                <div class="summary-card">
                    <h4>Daily P&L</h4>
                    <div class="summary-value" id="dailyPnl">₹0</div>
                </div>
            </div>
            
            <div class="add-holding-form">
                <h4>Add New Holding</h4>
                <div class="form-row">
                    <input type="text" id="stockSymbol" placeholder="Stock Symbol" class="form-control">
                    <input type="number" id="buyPrice" placeholder="Buy Price" class="form-control">
                    <input type="number" id="quantity" placeholder="Quantity" class="form-control">
                    <button class="btn btn-primary" onclick="addHolding()">Add Holding</button>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="portfolioChart"></canvas>
            </div>
        </div>
    </section>

    <!-- Trade Journal -->
    <section id="trade-journal" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Trading Journal</h2>
                <p>Log and analyze all your trades</p>
            </div>
            
            <div class="trade-entry-form">
                <h3>Log New Trade</h3>
                <div class="form-grid">
                    <input type="text" placeholder="Stock/Instrument" class="form-control" id="tradeInstrument">
                    <select class="form-control" id="tradeType">
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                    <input type="number" placeholder="Entry Price" class="form-control" id="entryPriceTrade">
                    <input type="number" placeholder="Exit Price" class="form-control" id="exitPriceTrade">
                    <input type="number" placeholder="Quantity" class="form-control" id="tradeQuantity">
                    <input type="text" placeholder="Strategy Used" class="form-control" id="tradeStrategy">
                    <textarea placeholder="Trade Notes" class="form-control" id="tradeNotes"></textarea>
                    <button class="btn btn-primary" onclick="saveTrade()">Save Trade</button>
                </div>
            </div>
            
            <div class="trade-statistics">
                <div class="stat-card">
                    <div class="stat-value" id="totalTradesCount">0</div>
                    <div class="stat-label">Total Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winningTrades">0</div>
                    <div class="stat-label">Winning Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="losingTrades">0</div>
                    <div class="stat-label">Losing Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="profitFactor">0.00</div>
                    <div class="stat-label">Profit Factor</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Strategy Builder -->
    <section id="strategy-builder" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Strategy Builder</h2>
                <p>Build your own trading strategies visually</p>
            </div>
            
            <div class="strategy-builder-container">
                <div class="toolbox">
                    <h4>Indicators</h4>
                    <div class="indicator" draggable="true" data-type="MA">
                        <i class="fas fa-chart-line"></i>
                        <span>Moving Average</span>
                    </div>
                    <div class="indicator" draggable="true" data-type="RSI">
                        <i class="fas fa-wave-square"></i>
                        <span>RSI</span>
                    </div>
                    <div class="indicator" draggable="true" data-type="MACD">
                        <i class="fas fa-chart-bar"></i>
                        <span>MACD</span>
                    </div>
                    
                    <h4>Conditions</h4>
                    <div class="condition" draggable="true" data-type="CROSS_ABOVE">
                        <i class="fas fa-arrow-up"></i>
                        <span>Cross Above</span>
                    </div>
                    <div class="condition" draggable="true" data-type="CROSS_BELOW">
                        <i class="fas fa-arrow-down"></i>
                        <span>Cross Below</span>
                    </div>
                    
                    <h4>Actions</h4>
                    <div class="action" draggable="true" data-type="BUY">
                        <i class="fas fa-shopping-cart"></i>
                        <span>BUY</span>
                    </div>
                    <div class="action" draggable="true" data-type="SELL">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>SELL</span>
                    </div>
                </div>
                
                <div class="workspace">
                    <div class="workspace-header">
                        <h4>Strategy Workspace</h4>
                        <button class="btn btn-primary" onclick="generateStrategyCode()">
                            <i class="fas fa-code"></i> Generate Code
                        </button>
                    </div>
                    
                    <div class="strategy-flow" id="strategyFlow">
                        <p>Drag and drop elements here to build your strategy</p>
                    </div>
                    
                    <div id="generatedCode" style="display: none;">
                        <h4>Generated Strategy Code</h4>
                        <pre><code id="strategyCode"></code></pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Alerts System -->
    <section id="alerts" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Trading Alerts</h2>
                <p>Set up price alerts for your stocks</p>
            </div>
            
            <div class="alerts-container">
                <div class="create-alert-form">
                    <h3>Create New Alert</h3>
                    <div class="alert-form">
                        <input type="text" id="alertSymbol" placeholder="Stock Symbol" class="form-control">
                        <select id="alertCondition" class="form-control">
                            <option value="ABOVE">Price Above</option>
                            <option value="BELOW">Price Below</option>
                        </select>
                        <input type="number" id="alertPrice" placeholder="Alert Price" class="form-control">
                        <select id="alertChannel" class="form-control">
                            <option value="BROWSER">Browser Notification</option>
                            <option value="EMAIL">Email</option>
                        </select>
                        <button class="btn btn-primary" onclick="createAlert()">
                            <i class="fas fa-bell"></i> Create Alert
                        </button>
                    </div>
                </div>
                
                <div class="active-alerts">
                    <h3>Active Alerts</h3>
                    <div class="alerts-list" id="alertsList">
                        <!-- Alerts will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- =================== ORIGINAL SECTIONS =================== -->

    <!-- Services Section -->
    <section id="services" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Our Services</h2>
                <p>Comprehensive algorithmic trading solutions</p>
            </div>
            <!-- Original services content -->
        </div>
    </section>

    <!-- Packages Section -->
    <section id="packages" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Our Trading Packages</h2>
                <p>Choose the perfect plan for your needs</p>
            </div>
            <!-- Original packages content -->
        </div>
    </section>

    <!-- Testimonials -->
    <section id="testimonials" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Client Testimonials</h2>
                <p>What our clients say about us</p>
            </div>
            <!-- Original testimonials content -->
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="content-section">
        <div class="container">
            <div class="section-header">
                <h2>Contact Us</h2>
                <p>Get in touch with our experts</p>
            </div>
            <!-- Original contact content -->
        </div>
    </section>

    <!-- =================== MODALS =================== -->

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login to Your Account</h3>
                <button class="close-modal" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-form">
                    <input type="email" id="loginEmail" placeholder="Email Address" class="form-control">
                    <input type="password" id="loginPassword" placeholder="Password" class="form-control">
                    <button class="btn btn-primary" onclick="loginUser()">Login</button>
                    <p>Don't have an account? <a href="#" onclick="showRegister()">Register here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Account</h3>
                <button class="close-modal" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-form">
                    <input type="text" id="regName" placeholder="Full Name" class="form-control">
                    <input type="email" id="regEmail" placeholder="Email Address" class="form-control">
                    <input type="tel" id="regPhone" placeholder="Phone Number" class="form-control">
                    <input type="password" id="regPassword" placeholder="Password" class="form-control">
                    <input type="password" id="regConfirmPassword" placeholder="Confirm Password" class="form-control">
                    <button class="btn btn-primary" onclick="registerUser()">Create Account</button>
                    <p>Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div class="modal" id="calculatorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Trading Calculators</h3>
                <button class="close-modal" onclick="closeModal('calculatorModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calculator-tabs">
                    <button class="calc-tab active" onclick="showCalcTab('profit')">Profit Calculator</button>
                    <button class="calc-tab" onclick="showCalcTab('position')">Position Sizing</button>
                    <button class="calc-tab" onclick="showCalcTab('option')">Option Calculator</button>
                </div>
                
                <div id="profitCalc" class="calc-content">
                    <!-- Profit calculator content -->
                </div>
                
                <div id="positionCalc" class="calc-content" style="display: none;">
                    <!-- Position sizing content -->
                </div>
                
                <div id="optionCalc" class="calc-content" style="display: none;">
                    <!-- Option calculator content -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // =================== GLOBAL VARIABLES ===================
        let currentUser = null;
        let portfolio = [];
        let trades = [];
        let alerts = [];
        let strategies = [];
        let equityChart = null;
        let portfolioChart = null;

        // =================== INITIALIZATION ===================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadUserData();
            startRealTimeUpdates();
        });

        function initializeApp() {
            // Check if user is logged in
            const savedUser = localStorage.getItem('algo_trading_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showUserProfile();
            }
            
            // Load saved data
            portfolio = JSON.parse(localStorage.getItem('portfolio')) || [];
            trades = JSON.parse(localStorage.getItem('trades')) || [];
            alerts = JSON.parse(localStorage.getItem('alerts')) || [];
            
            // Initialize charts
            initializeCharts();
            
            // Update displays
            updateMarketData();
            updatePortfolioDisplay();
            updateTradeStats();
            updateAlertsDisplay();
        }

        // =================== NAVIGATION ===================
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                
                // Update back button
                const backBtn = document.getElementById('backToHome');
                if (sectionId !== 'home') {
                    backBtn.style.display = 'flex';
                } else {
                    backBtn.style.display = 'none';
                }
                
                // Scroll to section
                window.scrollTo({
                    top: targetSection.offsetTop - 100,
                    behavior: 'smooth'
                });
                
                // Update URL hash
                window.location.hash = sectionId;
            }
        }

        // Back to home button
        document.getElementById('backToHome').addEventListener('click', function() {
            showSection('home');
        });

        // =================== USER AUTHENTICATION ===================
        function showLoginModal() {
            closeModal('registerModal');
            document.getElementById('loginModal').style.display = 'flex';
        }

        function showRegister() {
            closeModal('loginModal');
            document.getElementById('registerModal').style.display = 'flex';
        }

        function showLogin() {
            closeModal('registerModal');
            document.getElementById('loginModal').style.display = 'flex';
        }

        function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple validation
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            // For demo purposes - in real app, this would be server-side
            currentUser = {
                name: email.split('@')[0],
                email: email,
                joined: new Date().toISOString()
            };
            
            localStorage.setItem('algo_trading_user', JSON.stringify(currentUser));
            
            showUserProfile();
            closeModal('loginModal');
            alert('Login successful!');
        }

        function registerUser() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // For demo purposes
            currentUser = {
                name: name,
                email: email,
                phone: phone,
                joined: new Date().toISOString()
            };
            
            localStorage.setItem('algo_trading_user', JSON.stringify(currentUser));
            
            showUserProfile();
            closeModal('registerModal');
            alert('Registration successful!');
        }

        function showUserProfile() {
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('loginBtn').style.display = 'none';
            
            if (currentUser && currentUser.name) {
                const initials = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('userAvatar').textContent = initials;
                
                // Update user name in dropdown
                const userNameElement = document.querySelector('.user-profile span');
                if (userNameElement) {
                    userNameElement.textContent = currentUser.name;
                }
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('algo_trading_user');
            
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'block';
            
            alert('Logged out successfully');
            showSection('home');
        }

        // =================== BACKTESTING ===================
        function runBacktest() {
            const strategy = document.getElementById('strategySelect').value;
            const symbol = document.getElementById('backtestSymbol').value;
            const period = document.getElementById('backtestPeriod').value;
            const capital = parseInt(document.getElementById('initialCapital').value);
            
            // Simulate backtest results
            const results = simulateBacktest(strategy, symbol, period, capital);
            
            // Display results
            document.getElementById('totalReturn').textContent = results.totalReturn + '%';
            document.getElementById('totalProfit').textContent = '₹' + results.totalProfit.toLocaleString();
            document.getElementById('winRate').textContent = results.winRate + '%';
            document.getElementById('maxDrawdown').textContent = results.maxDrawdown + '%';
            
            // Show results section
            document.getElementById('backtestResults').style.display = 'block';
            
            // Update equity chart
            updateEquityChart(results.equityCurve);
        }

        function simulateBacktest(strategy, symbol, period, capital) {
            // Simulate backtest results
            const baseReturn = {
                'ma_crossover': 12.5,
                'rsi': 8.3,
                'bollinger': 15.2,
                'macd': 10.7
            }[strategy] || 10.0;
            
            const volatility = Math.random() * 5;
            const totalReturn = baseReturn + (Math.random() * volatility * 2 - volatility);
            const totalProfit = capital * (totalReturn / 100);
            const winRate = 60 + Math.random() * 20;
            const maxDrawdown = 5 + Math.random() * 10;
            
            // Generate equity curve
            const equityCurve = [];
            let currentEquity = capital;
            for (let i = 0; i < 30; i++) {
                const dailyReturn = (Math.random() - 0.5) * 2;
                currentEquity += currentEquity * (dailyReturn / 100);
                equityCurve.push(currentEquity);
            }
            
            return {
                totalReturn: totalReturn.toFixed(2),
                totalProfit: Math.round(totalProfit),
                winRate: winRate.toFixed(1),
                maxDrawdown: maxDrawdown.toFixed(1),
                equityCurve: equityCurve
            };
        }

        // =================== PORTFOLIO MANAGEMENT ===================
        function addHolding() {
            const symbol = document.getElementById('stockSymbol').value;
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!symbol || !buyPrice || !quantity) {
                alert('Please fill all fields');
                return;
            }
            
            const holding = {
                id: Date.now(),
                symbol: symbol.toUpperCase(),
                buyPrice: buyPrice,
                quantity: quantity,
                currentPrice: buyPrice * (1 + (Math.random() * 0.1 - 0.05)), // Simulate current price
                added: new Date().toISOString()
            };
            
            portfolio.push(holding);
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            
            updatePortfolioDisplay();
            
            // Clear form
            document.getElementById('stockSymbol').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('quantity').value = '';
            
            alert('Holding added successfully!');
        }

        function updatePortfolioDisplay() {
            let totalInvestment = 0;
            let currentValue = 0;
            
            portfolio.forEach(holding => {
                totalInvestment += holding.buyPrice * holding.quantity;
                currentValue += holding.currentPrice * holding.quantity;
                
                // Simulate price change
                holding.currentPrice *= (1 + (Math.random() * 0.02 - 0.01));
            });
            
            const totalPnl = currentValue - totalInvestment;
            const dailyPnl = totalPnl * (Math.random() * 0.1 - 0.05);
            
            // Update display
            document.getElementById('totalInvestment').textContent = '₹' + Math.round(totalInvestment).toLocaleString();
            document.getElementById('currentValue').textContent = '₹' + Math.round(currentValue).toLocaleString();
            document.getElementById('totalPnl').textContent = '₹' + Math.round(totalPnl).toLocaleString();
            document.getElementById('dailyPnl').textContent = '₹' + Math.round(dailyPnl).toLocaleString();
            
            // Update portfolio chart
            updatePortfolioChart();
            
            // Save updated portfolio
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
        }

        // =================== TRADE JOURNAL ===================
        function saveTrade() {
            const instrument = document.getElementById('tradeInstrument').value;
            const type = document.getElementById('tradeType').value;
            const entry = parseFloat(document.getElementById('entryPriceTrade').value);
            const exit = parseFloat(document.getElementById('exitPriceTrade').value);
            const quantity = parseInt(document.getElementById('tradeQuantity').value);
            const strategy = document.getElementById('tradeStrategy').value;
            const notes = document.getElementById('tradeNotes').value;
            
            if (!instrument || !entry || !quantity) {
                alert('Please fill required fields');
                return;
            }
            
            const trade = {
                id: Date.now(),
                date: new Date().toISOString(),
                instrument: instrument.toUpperCase(),
                type: type,
                entry: entry,
                exit: exit || entry * (type === 'BUY' ? 1.05 : 0.95), // Simulate exit if not provided
                quantity: quantity,
                strategy: strategy,
                notes: notes,
                pnl: type === 'BUY' ? (exit - entry) * quantity : (entry - exit) * quantity
            };
            
            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));
            
            updateTradeStats();
            
            // Clear form
            document.getElementById('tradeInstrument').value = '';
            document.getElementById('entryPriceTrade').value = '';
            document.getElementById('exitPriceTrade').value = '';
            document.getElementById('tradeQuantity').value = '';
            document.getElementById('tradeStrategy').value = '';
            document.getElementById('tradeNotes').value = '';
            
            alert('Trade saved successfully!');
        }

        function updateTradeStats() {
            if (trades.length === 0) {
                document.getElementById('totalTradesCount').textContent = '0';
                document.getElementById('winningTrades').textContent = '0';
                document.getElementById('losingTrades').textContent = '0';
                document.getElementById('profitFactor').textContent = '0.00';
                return;
            }
            
            const winningTrades = trades.filter(t => t.pnl > 0).length;
            const losingTrades = trades.filter(t => t.pnl < 0).length;
            
            const totalProfit = trades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0);
            const totalLoss = Math.abs(trades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0));
            
            const profitFactor = totalLoss > 0 ? (totalProfit / totalLoss).toFixed(2) : '∞';
            
            document.getElementById('totalTradesCount').textContent = trades.length;
            document.getElementById('winningTrades').textContent = winningTrades;
            document.getElementById('losingTrades').textContent = losingTrades;
            document.getElementById('profitFactor').textContent = profitFactor;
        }

        // =================== ALERTS SYSTEM ===================
        function createAlert() {
            const symbol = document.getElementById('alertSymbol').value;
            const condition = document.getElementById('alertCondition').value;
            const price = parseFloat(document.getElementById('alertPrice').value);
            const channel = document.getElementById('alertChannel').value;
            
            if (!symbol || !price) {
                alert('Please fill all fields');
                return;
            }
            
            const alert = {
                id: Date.now(),
                symbol: symbol.toUpperCase(),
                condition: condition,
                price: price,
                channel: channel,
                created: new Date().toISOString(),
                triggered: false
            };
            
            alerts.push(alert);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            
            updateAlertsDisplay();
            
            // Clear form
            document.getElementById('alertSymbol').value = '';
            document.getElementById('alertPrice').value = '';
            
            alert('Alert created successfully!');
        }

        function updateAlertsDisplay() {
            const alertsList = document.getElementById('alertsList');
            alertsList.innerHTML = '';
            
            alerts.slice(-5).forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert-item';
                alertDiv.innerHTML = `
                    <div>
                        <strong>${alert.symbol}</strong>
                        <br>
                        <small>${alert.condition} ₹${alert.price}</small>
                    </div>
                    <button class="delete-btn" onclick="deleteAlert(${alert.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                alertsList.appendChild(alertDiv);
            });
        }

        function deleteAlert(alertId) {
            alerts = alerts.filter(alert => alert.id !== alertId);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            updateAlertsDisplay();
        }

        // =================== STRATEGY BUILDER ===================
        function generateStrategyCode() {
            const elements = document.querySelectorAll('#strategyFlow .indicator, #strategyFlow .condition, #strategyFlow .action');
            
            if (elements.length === 0) {
                alert('Please add some elements to the workspace first');
                return;
            }
            
            let code = '// Generated Trading Strategy\n';
            code += 'function tradingStrategy() {\n';
            code += '    // Buy when:\n';
            
            elements.forEach((element, index) => {
                const type = element.getAttribute('data-type');
                code += `    // ${type}\n`;
            });
            
            code += '    return true;\n';
            code += '}\n';
            
            document.getElementById('strategyCode').textContent = code;
            document.getElementById('generatedCode').style.display = 'block';
        }

        // =================== MARKET DATA ===================
        function updateMarketData() {
            // Simulate market data updates
            const indices = ['nifty', 'banknifty', 'sensex'];
            
            indices.forEach(index => {
                const change = (Math.random() - 0.5) * 100;
                const price = {
                    'nifty': 22403.85,
                    'banknifty': 48026.90,
                    'sensex': 73895.54
                }[index];
                
                const currentPrice = price + change;
                const changePercent = (change / price) * 100;
                
                // Update ticker
                document.getElementById(`${index}Price`).textContent = currentPrice.toFixed(2);
                document.getElementById(`${index}Change`).textContent = 
                    `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${change >= 0 ? '+' : ''}${changePercent.toFixed(2)}%)`;
                
                // Update ticker class
                const ticker = document.getElementById(`${index}Ticker`);
                ticker.className = `ticker-item ${change >= 0 ? 'up' : 'down'}`;
            });
        }

        // =================== CHARTS ===================
        function initializeCharts() {
            // Initialize equity chart
            const equityCtx = document.getElementById('equityChart')?.getContext('2d');
            if (equityCtx) {
                equityChart = new Chart(equityCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 30}, (_, i) => `Day ${i + 1}`),
                        datasets: [{
                            label: 'Equity Curve',
                            data: [],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Backtest Performance'
                            }
                        }
                    }
                });
            }
            
            // Initialize portfolio chart
            const portfolioCtx = document.getElementById('portfolioChart')?.getContext('2d');
            if (portfolioCtx) {
                portfolioChart = new Chart(portfolioCtx, {
                    type: 'doughnut',
                    data: {
                        labels: portfolio.map(h => h.symbol),
                        datasets: [{
                            data: portfolio.map(h => h.currentPrice * h.quantity),
                            backgroundColor: [
                                '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            title: {
                                display: true,
                                text: 'Portfolio Allocation'
                            }
                        }
                    }
                });
            }
        }

        function updateEquityChart(data) {
            if (equityChart) {
                equityChart.data.datasets[0].data = data;
                equityChart.update();
            }
        }

        function updatePortfolioChart() {
            if (portfolioChart && portfolio.length > 0) {
                portfolioChart.data.labels = portfolio.map(h => h.symbol);
                portfolioChart.data.datasets[0].data = portfolio.map(h => h.currentPrice * h.quantity);
                portfolioChart.update();
            }
        }

        // =================== UTILITY FUNCTIONS ===================
        function openCalculator() {
            document.getElementById('calculatorModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showCalcTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.calc-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.calc-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Calc').style.display = 'block';
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function setupEventListeners() {
            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('navMenu').classList.toggle('active');
            });
            
            // Navigation links
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    showSection(targetId);
                    
                    // Close mobile menu if open
                    document.getElementById('navMenu').classList.remove('active');
                });
            });
            
            // Hash change listener
            window.addEventListener('hashchange', function() {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    showSection(hash);
                }
            });
            
            // Drag and drop for strategy builder
            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.indicator, .condition, .action');
            const workspace = document.getElementById('strategyFlow');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
                });
            });
            
            workspace.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            workspace.addEventListener('drop', function(e) {
                e.preventDefault();
                const type = e.dataTransfer.getData('text/plain');
                
                const element = document.createElement('div');
                element.className = 'indicator';
                element.setAttribute('data-type', type);
                element.draggable = true;
                element.innerHTML = `<i class="fas fa-${getIconForType(type)}"></i> <span>${type}</span>`;
                
                workspace.appendChild(element);
                
                // Make new element draggable
                element.addEventListener('dragstart', function(ev) {
                    ev.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
                });
            });
        }

        function getIconForType(type) {
            const icons = {
                'MA': 'chart-line',
                'RSI': 'wave-square',
                'MACD': 'chart-bar',
                'CROSS_ABOVE': 'arrow-up',
                'CROSS_BELOW': 'arrow-down',
                'BUY': 'shopping-cart',
                'SELL': 'money-bill-wave'
            };
            return icons[type] || 'circle';
        }

        function startRealTimeUpdates() {
            // Update market data every 5 seconds
            setInterval(updateMarketData, 5000);
            
            // Update portfolio every 10 seconds
            setInterval(updatePortfolioDisplay, 10000);
            
            // Check alerts every 3 seconds
            setInterval(checkAlerts, 3000);
        }

        function checkAlerts() {
            alerts.forEach(alert => {
                if (!alert.triggered) {
                    // Simulate checking current price
                    const currentPrice = 22403.85 * (1 + (Math.random() * 0.1 - 0.05));
                    
                    let shouldTrigger = false;
                    if (alert.condition === 'ABOVE' && currentPrice >= alert.price) {
                        shouldTrigger = true;
                    } else if (alert.condition === 'BELOW' && currentPrice <= alert.price) {
                        shouldTrigger = true;
                    }
                    
                    if (shouldTrigger) {
                        alert.triggered = true;
                        alert.triggeredAt = new Date().toISOString();
                        alert.triggeredPrice = currentPrice;
                        
                        // Show notification
                        if (Notification.permission === "granted") {
                            new Notification(`Alert: ${alert.symbol}`, {
                                body: `${alert.symbol} ${alert.condition} ₹${alert.price}\nCurrent: ₹${currentPrice.toFixed(2)}`,
                                icon: 'https://cdn-icons-png.flaticon.com/512/2933/2933116.png'
                            });
                        }
                        
                        // Save updated alerts
                        localStorage.setItem('alerts', JSON.stringify(alerts));
                        updateAlertsDisplay();
                    }
                }
            });
        }

        function loadUserData() {
            // Load any additional user data
            // This can be expanded based on requirements
        }

        // Request notification permission
        if ("Notification" in window) {
            Notification.requestPermission();
        }

        // Initialize with home section
        showSection('home');
    </script>
</body>
</html>
